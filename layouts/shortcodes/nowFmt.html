{{ $buildTime := now }}
{{ $format := .Get "format" | default "d" }}
{{ $isoFormat := $buildTime.Format "2006-01-02T15:04:05Z07:00" }}
{{ $fallbackFormat := $buildTime.Format "02 Jan 2006" }}

<time class="hugo-build-time" datetime="{{ $isoFormat }}" data-format="{{ $format }}">
    {{ $fallbackFormat }}
</time><script>
    (function() {
        function updateBuildTime(element) {
            var buildTime = new Date(element.getAttribute('datetime'));
            var format = element.getAttribute('data-format');
            var options;
            
            if (format === 'd') {
                // Format: D Mon YYYY
                element.textContent = buildTime.toLocaleDateString('en-GB', {
                    day: '2-digit', 
                    month: 'short', 
                    year: 'numeric'
                });
            } else if (format === 'F') {
                // Format: ISO 8601 with timezone offset
                var tzOffset = -buildTime.getTimezoneOffset();
                var diff = tzOffset >= 0 ? '+' : '-';
                var pad = function(n) {
                    return (n < 10 ? '0' : '') + n;
                };
                var hours = pad(Math.floor(Math.abs(tzOffset) / 60));
                var minutes = pad(Math.abs(tzOffset) % 60);
                
                element.textContent = buildTime.getFullYear() + '-' +
                    pad(buildTime.getMonth() + 1) + '-' +
                    pad(buildTime.getDate()) + 'T' +
                    pad(buildTime.getHours()) + ':' +
                    pad(buildTime.getMinutes()) + ':' +
                    pad(buildTime.getSeconds()) + 
                    diff + hours + ':' + minutes;
            }
        }
        
        var timeElements = document.querySelectorAll('time.hugo-build-time');
        for (var i = 0; i < timeElements.length; i++) {
            updateBuildTime(timeElements[i]);
        }
    })();
</script>